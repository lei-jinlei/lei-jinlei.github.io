# 数据库锁

### 数据库锁分类
    分为 悲观锁 和 乐观锁
       
### 悲观锁

    当我们要对数据库中的一条数据进行修改的时候，为了避免同时被其他人修改，最好的办法就是直接对该数据进行加锁以防止并发。这种借助数据库锁机制在修改数据之前锁定，再修改的方式被称为悲观并发控制（PCC）
    
在数据库中，悲观锁的流程如下：

- 在对数据修改前，尝试增加排他锁。
- 加锁失败，意味着数据正在被修改，进行等待或者抛出异常。
- 加锁成功，对数据进行修改，提交事务，锁释放。
- 如果我们加锁成功，有其他线程对该数据进行操作或者加排他锁的操作，只能等待或者抛出异常。

注:
    
    使用排他锁会把数据锁住，不过需要注意一些基本的锁级别，MySQL InnoDB 默认行级锁。行级锁是基于索引的，如果一条 SQL 语句用不到索引是不会使用行级锁，会使用表级锁把整张表锁住。
    
### 乐观锁
    乐观锁是相对悲观锁而言的，乐观锁假设数据一般情况下不会造成冲突，所以在数据进行提交更新的时候，才会正式对数据的冲突与否进行检测。
    

### 区别
1. 乐观锁不是真的加锁，效率高，但是要控制好锁的力度。
2. 悲观锁依赖数据库锁，效率低。
